<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å±…å®¶å¾©èƒ½èˆ‡éˆæ€§é—œæ‡·ç³»çµ±</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #f5f6fa;
            --text: #2d3436;
            --border: #dfe6e9;
            --success: #00b894;
            --danger: #d63031;
            --purple: #a55eea;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #eef2f5;
            color: var(--text);
            margin: 0;
            padding: 20px 10px 80px 10px; /* Bottom padding for fixed footer */
            line-height: 1.5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.5rem;
            margin: 0;
            color: #2c3e50;
        }

        .nav-tabs {
            display: flex;
            background: white;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            color: #636e72;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background-color: var(--secondary);
            color: var(--primary);
        }

        .nav-tab.active-reflection {
            background-color: #f3e5f5;
            color: var(--purple);
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* --- Styles from index.html --- */
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .card-header {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header.c-code { color: var(--danger); border-bottom-color: #fab1a0; }
        .card-header.spiritual { color: var(--purple); border-bottom-color: #e1b12c; }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95rem;
            color: #636e72;
        }

        input[type="text"], 
        input[type="number"], 
        input[type="date"],
        select, 
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px; /* Prevents zoom on iOS */
            background-color: #fff;
            transition: border-color 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .vitals-row {
            display: flex;
            gap: 10px;
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tag {
            background-color: var(--secondary);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            border: 1px solid var(--border);
            user-select: none;
            transition: all 0.2s;
        }

        .tag:active {
            transform: scale(0.95);
            background-color: #dcdde1;
        }

        /* Reflection Page Specific Styles */
        .competency-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        
        .competency-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3436;
        }

        .reflection-card {
            border-left: 5px solid var(--purple);
        }

        .reflection-tag {
            background-color: #f3e5f5;
            color: var(--purple);
            border: 1px solid #e1bee7;
        }

        /* Fixed Bottom Action Bar */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
        }

        .btn-preview {
            background-color: var(--secondary);
            color: var(--text);
        }

        .btn-copy {
            background-color: var(--primary);
            color: white;
        }

        .btn-copy-reflection {
            background-color: var(--purple);
            color: white;
        }

        /* Modal for Preview */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            padding: 20px;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .modal-body {
            padding: 15px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
            background-color: #f8f9fa;
            font-size: 0.9rem;
        }

        .modal-footer {
            padding: 15px;
            border-top: 1px solid var(--border);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>ğŸ“ å±…å®¶å¾©èƒ½èˆ‡éˆæ€§é—œæ‡·</h1>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('record')">ğŸ“‹ å¾©èƒ½ç´€éŒ„</div>
            <div class="nav-tab" onclick="switchTab('reflection')">ğŸ•Šï¸ è‡ªæˆ‘åæ€</div>
        </div>

        <!-- ==================== å¾©èƒ½ç´€éŒ„å€å¡Š (Record Section) ==================== -->
        <div id="section-record" class="content-section active">
            <!-- æ—¥æœŸé¸æ“‡ -->
            <div class="form-group">
                <label>æ—¥æœŸ</label>
                <input type="date" id="recordDate">
            </div>

            <!-- S: ä¸»è¨´ -->
            <div class="card">
                <div class="card-header">S (ä¸»è¨´)</div>
                <div class="form-group">
                    <label>ç²¾ç¥èˆ‡é…åˆåº¦</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('s_mood', 'ç²¾ç¥ä½³ï¼Œé…åˆåº¦é«˜')">ç²¾ç¥ä½³</span>
                        <span class="tag" onclick="addText('s_mood', 'ç²¾ç¥å°šå¯ï¼Œé…åˆåº¦æ™®é€š')">ç²¾ç¥å°šå¯</span>
                        <span class="tag" onclick="addText('s_mood', 'ç²¾ç¥å·®ï¼Œæ˜“ç–²å€¦')">ç²¾ç¥å·®</span>
                        <span class="tag" onclick="addText('s_mood', 'ç–¼ç—›ä¸»è¨´ï¼Œå½±éŸ¿æ´»å‹•')">ç–¼ç—›</span>
                    </div>
                    <textarea id="s_mood" rows="2" placeholder="è¼¸å…¥ä¸»è¨´..."></textarea>
                </div>
            </div>

            <!-- éˆæ€§é—œæ‡· (é¸å¡«) -->
            <div class="card" style="border-left: 5px solid var(--purple);">
                <div class="card-header spiritual">ğŸ•Šï¸ éˆæ€§é—œæ‡· (é¸å¡«)</div>
                
                <div class="form-group">
                    <label>è©•ä¼°é¢å‘ & éšæ®µ</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('spirit_dim', 'ç”Ÿå‘½æ„ç¾©')">ç”Ÿå‘½æ„ç¾©</span>
                        <span class="tag" onclick="addText('spirit_dim', 'æ„›')">æ„›</span>
                        <span class="tag" onclick="addText('spirit_dim', 'å¯¬æ•')">å¯¬æ•</span>
                        <span class="tag" onclick="addText('spirit_dim', 'ä¿¡ä»°')">ä¿¡ä»°</span>
                        <span class="tag" onclick="addText('spirit_dim', 'ç›¼æœ›')">ç›¼æœ›</span>
                    </div>
                    <input type="text" id="spirit_dim" placeholder="é¢å‘...">
                    <select id="spirit_stage" style="margin-top: 10px;">
                        <option value="">-- é¸æ“‡éšæ®µ --</option>
                        <option value="ç¬¬ä¸€éšæ®µï¼šç™¼ç¾èˆ‡æ‰¿èª">ç¬¬ä¸€éšæ®µï¼šç™¼ç¾èˆ‡æ‰¿èª</option>
                        <option value="ç¬¬äºŒéšæ®µï¼šæ·±å…¥æ¢ç´¢">ç¬¬äºŒéšæ®µï¼šæ·±å…¥æ¢ç´¢</option>
                        <option value="ç¬¬ä¸‰éšæ®µï¼šæ‰¾åˆ°è§£æ±ºæ–¹æ³•">ç¬¬ä¸‰éšæ®µï¼šæ‰¾åˆ°è§£æ±ºæ–¹æ³•</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>äº’å‹•ç´€éŒ„</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('spirit_note', 'ç”Ÿå‘½å›é¡§')">ç”Ÿå‘½å›é¡§</span>
                        <span class="tag" onclick="addText('spirit_note', 'é“è¬é“æ„›')">é“è¬é“æ„›</span>
                        <span class="tag" onclick="addText('spirit_note', 'ä¿¡ä»°æ”¯æŒ')">ä¿¡ä»°æ”¯æŒ</span>
                    </div>
                    <textarea id="spirit_note" rows="2" placeholder="éˆæ€§äº’å‹•ç´€éŒ„..."></textarea>
                </div>
            </div>

            <!-- O: å®¢è§€æ•¸æ“š -->
            <div class="card">
                <div class="card-header">O (å®¢è§€æ•¸æ“š)</div>
                <div class="form-group">
                    <label>ç”Ÿå‘½å¾µè±¡</label>
                    <div class="vitals-row">
                        <input type="text" id="bp" placeholder="è¡€å£“ mmHg">
                        <input type="text" id="hr" placeholder="å¿ƒè·³ bpm">
                    </div>
                    <div class="vitals-row" style="margin-top: 10px;">
                        <input type="text" id="spo2" placeholder="è¡€æ°§ %">
                        <button type="button" onclick="setVitals('æ²’æœ‰é‡')" style="padding: 0 15px; background: #dfe6e9; border:none; border-radius: 8px;">æœªæ¸¬é‡</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>è¨“ç·´å…§å®¹</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('o_activity', 'åå§¿å¹³è¡¡è¨“ç·´')">åå§¿å¹³è¡¡</span>
                        <span class="tag" onclick="addText('o_activity', 'ç«™ç«‹è€åŠ›è¨“ç·´')">ç«™ç«‹è€åŠ›</span>
                        <span class="tag" onclick="addText('o_activity', 'ä¸‹è‚¢è‚ŒåŠ›å¼·åŒ–')">ä¸‹è‚¢è‚ŒåŠ›</span>
                        <span class="tag" onclick="addText('o_activity', 'å®¤å…§è¡Œèµ°è¨“ç·´')">å®¤å…§è¡Œèµ°</span>
                        <span class="tag" onclick="addText('o_activity', 'ä¸Šä¸‹æ¨“æ¢¯ç·´ç¿’')">ä¸Šä¸‹æ¨“æ¢¯</span>
                        <span class="tag" onclick="addText('o_activity', 'ROMé‹å‹•')">ROM</span>
                    </div>
                    <textarea id="o_activity" rows="3" placeholder="è¼¸å…¥è¨“ç·´å…§å®¹..."></textarea>
                </div>
            </div>
            
            <!-- P: è¨ˆç•« -->
            <div class="card">
                <div class="card-header">P (è¨ˆç•«)</div>
                <div class="form-group">
                    <div class="tag-container">
                        <span class="tag" onclick="addText('p_plan', 'æŒçºŒç›®å‰å¾©èƒ½è¨ˆç•«')">æŒçºŒè¨ˆç•«</span>
                        <span class="tag" onclick="addText('p_plan', 'åŠ å¼·å±…å®¶è‡ªä¸»ç·´ç¿’')">åŠ å¼·ç·´ç¿’</span>
                    </div>
                    <textarea id="p_plan" rows="2" placeholder="å¾ŒçºŒè¨ˆç•«..."></textarea>
                </div>
            </div>

            <!-- A: è©•ä¼° -->
            <div class="card">
                <div class="card-header">A (è©•ä¼°)</div>
                <div class="form-group">
                    <div class="tag-container">
                        <span class="tag" onclick="addText('a_assessment', 'åŠŸèƒ½ç¶­æŒï¼Œç‹€æ³ç©©å®š')">ç‹€æ³ç©©å®š</span>
                        <span class="tag" onclick="addText('a_assessment', 'è‚ŒåŠ›èˆ‡è€åŠ›è¼ƒä¸Šæ¬¡é€²æ­¥')">è‚ŒåŠ›é€²æ­¥</span>
                        <span class="tag" onclick="addText('a_assessment', 'å‹•ä½œæ§åˆ¶èƒ½åŠ›æå‡')">æ§åˆ¶æå‡</span>
                        <span class="tag" onclick="addText('a_assessment', 'ä»Šæ—¥é«”åŠ›è¼ƒå·®')">é«”åŠ›å·®</span>
                        <span class="tag" onclick="addText('a_assessment', 'å¹³è¡¡æ„Ÿéœ€åŠ å¼·')">å¹³è¡¡å·®</span>
                    </div>
                    <textarea id="a_assessment" rows="3" placeholder="æ•´é«”è©•ä¼°..."></textarea>
                </div>
            </div>

            <!-- Cç¢¼ç”³å ± (å¿…å¡«) -->
            <div class="card" style="border-left: 5px solid var(--danger);">
                <div class="card-header c-code">ğŸ—ï¸ Cç¢¼ç”³å ± (å¿…å¡«)</div>
                
                <div class="form-group">
                    <label>å¾©èƒ½ç›®æ¨™é”æˆæƒ…å½¢</label>
                    <select id="c_status">
                        <option value="å°šæœªæ»¿1ç…§é¡§çµ„åˆä¹‹æ¬¡æ•¸">å°šæœªæ»¿1ç…§é¡§çµ„åˆä¹‹æ¬¡æ•¸</option>
                        <option value="å·²æ»¿1ç…§é¡§çµ„åˆä¹‹æ¬¡æ•¸,ä¸”å·²é”ç›®æ¨™">å·²æ»¿1ç…§é¡§çµ„åˆ...ä¸”å·²é”æ¨™</option>
                        <option value="å·²æ»¿1ç…§é¡§çµ„åˆä¹‹æ¬¡æ•¸,ä½†å°šæœªé”ç›®æ¨™">å·²æ»¿1ç…§é¡§çµ„åˆ...ä½†æœªé”æ¨™</option>
                        <option value="æœªæ»¿1ç…§é¡§çµ„åˆä¹‹æ¬¡æ•¸,ä¸”å·²é”ç›®æ¨™">æœªæ»¿1ç…§é¡§çµ„åˆ...ä¸”å·²é”æ¨™</option>
                        <option value="æœªæ»¿1ç…§é¡§çµ„åˆä¹‹æ¬¡æ•¸,ä½†å°šæœªé”ç›®æ¨™">æœªæ»¿1ç…§é¡§çµ„åˆ...ä½†æœªé”æ¨™</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>å¾©èƒ½ç›®æ¨™ (è«‹ä¾å€‹æ¡ˆç­‰ç´šé¸æ“‡)</label>
                    
                    <div style="margin-bottom: 10px; border-bottom: 1px dashed #ddd; padding-bottom: 8px;">
                        <label style="font-size: 0.85rem; color: #2ecc71;">ğŸŸ¢ é•·ç…§ç­‰ç´š 2-3 ç´š (è¼•åº¦)</label>
                        <div class="tag-container">
                            <span class="tag" onclick="addText('c_goal', 'å¤–å‡ºåƒèˆ‡ç¤¾å€æ´»å‹•')">åƒèˆ‡ç¤¾å€</span>
                            <span class="tag" onclick="addText('c_goal', 'å¯è‡ªè¡Œå‚™é¤èˆ‡é€²é£Ÿ')">è‡ªè¡Œå‚™é¤</span>
                            <span class="tag" onclick="addText('c_goal', 'ä½¿ç”¨è¼”å…·ç¨ç«‹è¡Œèµ°50å…¬å°º')">è¡Œèµ°50M</span>
                            <span class="tag" onclick="addText('c_goal', 'å¯è‡ªè¡Œä¸Šä¸‹æ¨“æ¢¯')">ä¸Šä¸‹æ¨“æ¢¯</span>
                            <span class="tag" onclick="addText('c_goal', 'ç¨ç«‹å®Œæˆæ²æµ´æ›´è¡£')">æ²æµ´æ›´è¡£</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 10px; border-bottom: 1px dashed #ddd; padding-bottom: 8px;">
                        <label style="font-size: 0.85rem; color: #f39c12;">ğŸŸ  é•·ç…§ç­‰ç´š 4-6 ç´š (ä¸­åº¦)</label>
                        <div class="tag-container">
                            <span class="tag" onclick="addText('c_goal', 'å¯è‡ªè¡Œç¿»èº«åèµ·')">ç¿»èº«åèµ·</span>
                            <span class="tag" onclick="addText('c_goal', 'ç¶­æŒç«™ç«‹å¹³è¡¡3åˆ†é˜')">ç«™ç«‹3åˆ†</span>
                            <span class="tag" onclick="addText('c_goal', 'å”åŠ©ä¸‹å®Œæˆå¦‚å»')">å”åŠ©å¦‚å»</span>
                            <span class="tag" onclick="addText('c_goal', 'å®¤å…§ä½¿ç”¨åŠ©è¡Œå™¨è¡Œèµ°10å…¬å°º')">è¡Œèµ°10M</span>
                            <span class="tag" onclick="addText('c_goal', 'ç”±åºŠè½‰ä½è‡³è¼ªæ¤…(éœ€éƒ¨åˆ†å”åŠ©)')">è½‰ä½(éƒ¨åˆ†)</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.85rem; color: #e74c3c;">ğŸ”´ é•·ç…§ç­‰ç´š 7-8 ç´š (é‡åº¦)</label>
                        <div class="tag-container">
                            <span class="tag" onclick="addText('c_goal', 'ç¶­æŒé—œç¯€æ´»å‹•åº¦(é¿å…æ”£ç¸®)')">é¿å…æ”£ç¸®</span>
                            <span class="tag" onclick="addText('c_goal', 'é…åˆç¿»èº«æ‹èƒŒ(é™ä½å£“å‚·)')">é…åˆç¿»èº«</span>
                            <span class="tag" onclick="addText('c_goal', 'å¯ç¶­æŒåå§¿15åˆ†é˜')">åå§¿15åˆ†</span>
                            <span class="tag" onclick="addText('c_goal', 'æå‡ç…§é¡§è€…è½‰ä½æŠ€å·§(æ¸›è¼•è² æ“”)')">å®¶å±¬è½‰ä½</span>
                            <span class="tag" onclick="addText('c_goal', 'å¢åŠ ç’°å¢ƒåˆºæ¿€åæ‡‰')">å¢åŠ åæ‡‰</span>
                        </div>
                    </div>

                    <textarea id="c_goal" rows="2" placeholder="é»æ“Šä¸Šæ–¹æ¨™ç±¤é¸æ“‡ç›®æ¨™..."></textarea>
                </div>

                <div class="form-group">
                    <label>æŒ‡å°å°è±¡</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('c_target', 'å€‹æ¡ˆæœ¬äºº')">å€‹æ¡ˆ</span>
                        <span class="tag" onclick="addText('c_target', 'ä¸»è¦ç…§é¡§è€…(å®¶å±¬)')">å®¶å±¬</span>
                        <span class="tag" onclick="addText('c_target', 'å¤–ç±çœ‹è­·')">å¤–ç±çœ‹è­·</span>
                    </div>
                    <input type="text" id="c_target" placeholder="æŒ‡å°å°è±¡">
                </div>

                <div class="form-group">
                    <label>æœå‹™å…§å®¹</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('c_content', 'åŸ·è¡Œå¾©èƒ½è‚ŒåŠ›è¨“ç·´')">è‚ŒåŠ›è¨“ç·´</span>
                        <span class="tag" onclick="addText('c_content', 'æŒ‡å°å¹³è¡¡èˆ‡å”èª¿')">å¹³è¡¡é‹å‹•</span>
                        <span class="tag" onclick="addText('c_content', 'æ­¥æ…‹çŸ¯æ­£èˆ‡è¡Œèµ°')">è¡Œèµ°è¨“ç·´</span>
                        <span class="tag" onclick="addText('c_content', 'è¼”å…·ä½¿ç”¨æŒ‡å°')">è¼”å…·æŒ‡å°</span>
                    </div>
                    <textarea id="c_content" rows="2" placeholder="æœå‹™å…§å®¹..."></textarea>
                </div>

                <div class="form-group">
                    <label>æŒ‡å°å»ºè­°æ‘˜è¦ (å›å®¶åŠŸèª²)</label>
                    <div class="tag-container">
                        <span class="tag" onclick="addText('c_suggestion', 'è«‹å®¶å±¬ç£ä¿ƒæ¯æ—¥ç·´ç¿’')">ç£ä¿ƒç·´ç¿’</span>
                        <span class="tag" onclick="addText('c_suggestion', 'æ³¨æ„é˜²è·Œèˆ‡ç’°å¢ƒå®‰å…¨')">é˜²è·Œå®‰å…¨</span>
                        <span class="tag" onclick="addText('c_suggestion', 'å»ºè­°ä½¿ç”¨åˆé©è¼”å…·')">å»ºè­°è¼”å…·</span>
                    </div>

                    <!-- FITT æœ‰æ°§é«”é©èƒ½æŒ‡å¼• -->
                    <div style="margin-top: 10px; background-color: #fff8e1; padding: 10px; border-radius: 8px; border: 1px dashed #ffb74d;">
                        <div style="font-size: 0.85rem; font-weight: bold; color: #ef6c00; margin-bottom: 5px;">â¤ï¸ æœ‰æ°§/å¥åº·é«”é©èƒ½ FITT å»ºè­°ï¼š</div>
                        
                        <div style="margin-bottom: 5px;">
                            <span style="font-weight:bold; color:#f57c00;">F é »ç‡ (Frequency):</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'é »ç‡ï¼šæ¯é€±è‡³å°‘ 3-5 å¤©')">æ¯é€±3-5å¤©</span>
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'é »ç‡ï¼šæ¯æ—¥é€²è¡Œ')">æ¯æ—¥</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 5px;">
                            <span style="font-weight:bold; color:#f57c00;">I å¼·åº¦ (Intensity):</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'å¼·åº¦ï¼šä¸­ç­‰å¼·åº¦ (RPE 12-13, æœ‰é»å–˜ä½†å¯èªªè©±)')">ä¸­ç­‰(å¾®å–˜)</span>
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'å¼·åº¦ï¼šä½å¼·åº¦ (RPE 9-11, è¼•é¬†ä¸è²»åŠ›)')">ä½å¼·åº¦(è¼•é¬†)</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 5px;">
                            <span style="font-weight:bold; color:#f57c00;">T æ™‚é–“ (Time):</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'æ™‚é–“ï¼šæ¯æ¬¡ 20-60 åˆ†é˜')">20-60åˆ†</span>
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'æ™‚é–“ï¼šåˆ†æ®µç´¯ç© (æ¯æ¬¡10åˆ† x 3å›)')">åˆ†æ®µç´¯ç©</span>
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'æ™‚é–“ï¼šæ¯é€±ç´¯ç©è‡³å°‘ 150 åˆ†é˜')">é€±ç´¯ç©150åˆ†</span>
                            </div>
                        </div>

                        <div>
                            <span style="font-weight:bold; color:#f57c00;">T é¡å‹ (Type):</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'é …ç›®ï¼šå¤§è‚Œè‚‰ç¾¤éŸ»å¾‹æ€§é‹å‹• (å¦‚å¥èµ°)')">å¥èµ°</span>
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'é …ç›®ï¼šå›ºå®šå¼è…³è¸è»Š')">è…³è¸è»Š</span>
                                <span class="tag" style="background:white; border:1px solid #ffe0b2; color:#ef6c00;" onclick="addText('c_suggestion', 'é …ç›®ï¼šä¸Šä¸‹è‚¢ä¸»å‹•é—œç¯€æ´»å‹•')">ä¸»å‹•æ´»å‹•</span>
                            </div>
                        </div>
                    </div>

                    <textarea id="c_suggestion" rows="3" placeholder="è«‹è©³ç´°åˆ—å‡ºå›å®¶åŠŸèª² (é …ç›®ã€æ¬¡æ•¸ã€é »ç‡)..."></textarea>
                </div>
            </div>

        <!-- ==================== è‡ªæˆ‘åæ€å€å¡Š (Reflection Section) ==================== -->
        <div id="section-reflection" class="content-section">
            <div class="card reflection-card">
                <div class="card-header" style="color: var(--purple); border-bottom-color: #e1b12c;">æ ¸å¿ƒèƒ½åŠ›è‡ªæˆ‘æª¢è¦– (EAPC-10)</div>
                
                <div class="competency-item">
                    <div class="competency-title">1. è¾¨è­˜éˆæ€§éœ€æ±‚</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c1', 'å·²ä¸»å‹•è©¢å•å€‹æ¡ˆä¿¡ä»°')">ä¸»å‹•è©¢å•ä¿¡ä»°</span>
                        <span class="tag reflection-tag" onclick="addText('c1', 'è§€å¯Ÿåˆ°å€‹æ¡ˆçš„éèªè¨€è¨Šè™Ÿ')">è§€å¯Ÿéèªè¨€è¨Šè™Ÿ</span>
                        <span class="tag reflection-tag" onclick="addText('c1', 'å¯Ÿè¦ºå€‹æ¡ˆçš„éˆæ€§å›°æ“¾')">å¯Ÿè¦ºéˆæ€§å›°æ“¾</span>
                    </div>
                    <textarea id="c1" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">2. è©•ä¼°éˆæ€§èˆ‡å®—æ•™</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c2', 'ä½¿ç”¨FICAå·¥å…·è©•ä¼°')">ä½¿ç”¨FICAå·¥å…·</span>
                        <span class="tag reflection-tag" onclick="addText('c2', 'äº†è§£å€‹æ¡ˆçš„å®—æ•™ç¦å¿Œ')">äº†è§£å®—æ•™ç¦å¿Œ</span>
                        <span class="tag reflection-tag" onclick="addText('c2', 'è©•ä¼°ä¿¡ä»°å°é†«ç™‚æ±ºç­–çš„å½±éŸ¿')">ä¿¡ä»°å½±éŸ¿æ±ºç­–</span>
                    </div>
                    <!-- FICA å·¥å…·æç¤ºå¡ -->
                    <div style="margin-top: 10px; background-color: #fff3e0; padding: 10px; border-radius: 8px; border: 1px dashed #ffb74d;">
                        <div style="font-size: 0.85rem; font-weight: bold; color: #e65100; margin-bottom: 5px;">ğŸ› ï¸ FICA éˆæ€§è©•ä¼°å•å¥ï¼š</div>
                        
                        <div style="margin-bottom: 8px;">
                            <span style="font-weight:bold; color:#ef6c00;">F (Faith) ä¿¡ä»°èˆ‡ä¿¡å¿µ:</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:æ‚¨èªç‚ºè‡ªå·±æœ‰éˆæ€§æˆ–å®—æ•™ä¿¡ä»°å—ï¼Ÿ')">æœ‰ä¿¡ä»°å—?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:ä»€éº¼è®“æ‚¨çš„ç”Ÿæ´»æœ‰æ„ç¾©ï¼Ÿ')">ç”Ÿæ´»æ„ç¾©?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:è«‹å½¢å®¹æ‚¨å¿ƒä¸­çš„ç¥ï¼Ÿ')">å½¢å®¹å¿ƒä¸­çš„ç¥</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 8px;">
                            <span style="font-weight:bold; color:#ef6c00;">I (Importance) é‡è¦æ€§:</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:ä¿¡ä»°åœ¨æ‚¨çš„ç”Ÿæ´»ä¸­æœ‰å¤šé‡è¦ï¼Ÿ')">ä¿¡ä»°é‡è¦æ€§?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:ä¿¡ä»°æ˜¯å¦å½±éŸ¿äº†æ‚¨çš„è‡ªæˆ‘ç…§é¡§ï¼Ÿ')">å½±éŸ¿è‡ªæˆ‘ç…§é¡§?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:ä¿¡ä»°åœ¨æ¢å¾©å¥åº·ä¸­æ‰®æ¼”ä»€éº¼è§’è‰²ï¼Ÿ')">æ¢å¾©å¥åº·çš„è§’è‰²?</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 8px;">
                            <span style="font-weight:bold; color:#ef6c00;">C (Community) ç¤¾ç¾¤:</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:æ‚¨æ˜¯å®—æ•™ç¤¾ç¾¤çš„ä¸€ä»½å­å—ï¼Ÿ')">ç¤¾ç¾¤ä¸€ä»½å­?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:é€™å°æ‚¨æœ‰ä½•å¹«åŠ©ï¼Ÿ')">æœ‰ä½•å¹«åŠ©?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:åœ¨ä¿¡ä»°ä¸Šæœ‰èª°çµ¦ä½ æ”¯æŒï¼Ÿ')">èª°çµ¦æ”¯æŒ?</span>
                            </div>
                        </div>

                        <div>
                            <span style="font-weight:bold; color:#ef6c00;">A (Address) é—œæ‡·è™•ç†:</span>
                            <div class="tag-container" style="margin-top:3px;">
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:æ‚¨å¸Œæœ›æˆ‘å¦‚ä½•è™•ç†é€™äº›å•é¡Œï¼Ÿ')">å¸Œæœ›æˆ‘å¦‚ä½•è™•ç†?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:æˆ‘å¯ä»¥å¦‚ä½•åœ¨ä¿¡ä»°ä¸­çµ¦ä½ æ”¯æŒï¼Ÿ')">å¦‚ä½•çµ¦ä½ æ”¯æŒ?</span>
                                <span class="tag" style="background:white; border:1px solid #ffcc80; color:#ef6c00;" onclick="addText('c2', 'å•:ä½ æƒ³è½è–è©©æˆ–è–ç¶“CDå—ï¼Ÿ')">æƒ³è½è–è©©/è®€ç¶“?</span>
                            </div>
                        </div>
                    </div>
                    <textarea id="c2" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">3. å°Šé‡æ–‡åŒ–èˆ‡åƒ¹å€¼</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c3', 'å°Šé‡å€‹æ¡ˆçš„åƒ¹å€¼è§€')">å°Šé‡åƒ¹å€¼è§€</span>
                        <span class="tag reflection-tag" onclick="addText('c3', 'ä¸å°‡å€‹äººä¿¡ä»°å¼·åŠ æ–¼äºº')">ä¸å¼·åŠ ä¿¡ä»°</span>
                        <span class="tag reflection-tag" onclick="addText('c3', 'æ¥ç´å¤šå…ƒæ–‡åŒ–å·®ç•°')">æ¥ç´æ–‡åŒ–å·®ç•°</span>
                    </div>
                    <textarea id="c3" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>
                
                <div class="competency-item">
                    <div class="competency-title">4. å±•ç¾åŒç†å¿ƒ</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c4', 'å°ˆæ³¨å‚¾è½')">å°ˆæ³¨å‚¾è½</span>
                        <span class="tag reflection-tag" onclick="addText('c4', 'åŒç†å›æ‡‰å€‹æ¡ˆæƒ…ç·’')">åŒç†å›æ‡‰</span>
                        <span class="tag reflection-tag" onclick="addText('c4', 'æä¾›é™ªä¼´èˆ‡æ”¯æŒ')">æä¾›é™ªä¼´</span>
                    </div>
                    <textarea id="c4" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">5. é‹ç”¨æºé€šæŠ€å·§</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c5', 'é‹ç”¨é–‹æ”¾å¼å•å¥')">é–‹æ”¾å¼å•å¥</span>
                        <span class="tag reflection-tag" onclick="addText('c5', 'é©ç•¶çš„æ²‰é»˜èˆ‡åœé “')">é©ç•¶æ²‰é»˜</span>
                        <span class="tag reflection-tag" onclick="addText('c5', 'æ ¸å°èˆ‡æ¾„æ¸…èªæ„')">æ ¸å°æ¾„æ¸…</span>
                    </div>
                    <!-- ç”Ÿå‘½æ„ç¾©æ¢ç´¢æå• (åƒè€ƒ CADENZA Training) -->
                    <div style="margin-top: 10px; background-color: #e8f5e9; padding: 10px; border-radius: 8px; border: 1px dashed #66bb6a;">
                        <div style="font-size: 0.85rem; font-weight: bold; color: #2e7d32; margin-bottom: 5px;">ğŸŒ± å°‹æ‰¾æ„ç¾©çš„æå• (åƒè€ƒè©±è¡“)ï¼š</div>
                        <div class="tag-container">
                            <span class="tag" style="background: white; border: 1px solid #81c784; color: #2e7d32;" onclick="addText('c5', 'å•:åœ¨éå»çš„æ—¥å­ï¼Œä½ å¦‚ä½•è™•ç†å›°é›£ï¼Ÿ')">å¦‚ä½•è™•ç†å›°é›£?</span>
                            <span class="tag" style="background: white; border: 1px solid #81c784; color: #2e7d32;" onclick="addText('c5', 'å•:ä»€éº¼èƒ½çµ¦ä½ æœ€å¤§çš„å®‰æ…°ï¼Ÿ')">æœ€å¤§å®‰æ…°æ˜¯ä»€éº¼?</span>
                            <span class="tag" style="background: white; border: 1px solid #81c784; color: #2e7d32;" onclick="addText('c5', 'å•:å¦‚ä½•æ‰å¯ä»¥å»ºç«‹ä½ é¢å°å›°é›£çš„èƒ½åŠ›ï¼Ÿ')">å»ºç«‹é¢å°èƒ½åŠ›?</span>
                            <span class="tag" style="background: white; border: 1px solid #81c784; color: #2e7d32;" onclick="addText('c5', 'å•:ç¾æ™‚æœ‰ä»€éº¼å¯ä»¥çµ¦äºˆä½ å®‰æ…°ï¼Ÿ')">ç¾æ™‚å®‰æ…°ä¾†æº?</span>
                            <span class="tag" style="background: white; border: 1px solid #81c784; color: #2e7d32;" onclick="addText('c5', 'ç¸±ä½¿é†«ç”Ÿèªªæ˜¯æ™šæœŸï¼Œä½†åœ¨é€™å›°å¢ƒä¸­ï¼Œæˆ‘å€‘ä»æœ‰å¾ˆå¤šå¯ä»¥åšçš„ã€‚')">ä»æœ‰å¾ˆå¤šå¯åšçš„</span>
                        </div>
                    </div>
                    <textarea id="c5" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">6. è‡ªæˆ‘è¦ºå¯Ÿèˆ‡åæ€</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c6', 'è¦ºå¯Ÿè‡ªèº«æƒ…ç·’åæ‡‰')">è¦ºå¯Ÿè‡ªèº«æƒ…ç·’</span>
                        <span class="tag reflection-tag" onclick="addText('c6', 'åæ€å€‹äººçš„éˆæ€§è­°é¡Œ')">åæ€å€‹äººè­°é¡Œ</span>
                        <span class="tag reflection-tag" onclick="addText('c6', 'é¿å…éåº¦æ¶‰å…¥æˆ–æŠ½é›¢')">ä¿æŒå°ˆæ¥­ç•Œç·š</span>
                    </div>
                    <textarea id="c6" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">7. åœ˜éšŠåˆä½œèˆ‡è½‰ä»‹</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c7', 'èˆ‡è·¨å°ˆæ¥­åœ˜éšŠè¨è«–')">è·¨å°ˆæ¥­è¨è«–</span>
                        <span class="tag reflection-tag" onclick="addText('c7', 'é©æ™‚è½‰ä»‹éˆæ€§é—œæ‡·å¸«')">è½‰ä»‹éˆæ€§å¸«</span>
                        <span class="tag reflection-tag" onclick="addText('c7', 'é‚€è«‹å®—æ•™äººå“¡å”åŠ©')">é‚€è«‹å®—æ•™äººå“¡</span>
                    </div>
                    <textarea id="c7" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">8. å€«ç†èˆ‡æ³•å¾‹è€ƒé‡</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c8', 'ç¶­è­·å€‹æ¡ˆéš±ç§')">ç¶­è­·éš±ç§</span>
                        <span class="tag reflection-tag" onclick="addText('c8', 'éµå®ˆå°ˆæ¥­å€«ç†è¦ç¯„')">éµå®ˆå€«ç†</span>
                        <span class="tag reflection-tag" onclick="addText('c8', 'å°Šé‡è‡ªä¸»æ¬Š')">å°Šé‡è‡ªä¸»æ¬Š</span>
                    </div>
                    <textarea id="c8" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">9. è¨˜éŒ„èˆ‡å ±å‘Š</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c9', 'æ’°å¯«å®¢è§€å…·é«”çš„ç´€éŒ„')">æ’°å¯«å®¢è§€ç´€éŒ„</span>
                        <span class="tag reflection-tag" onclick="addText('c9', 'ä¿è­·æ•æ„Ÿè³‡è¨Š')">ä¿è­·æ•æ„Ÿè³‡è¨Š</span>
                        <span class="tag reflection-tag" onclick="addText('c9', 'æ–¼äº¤ç­æ™‚å ±å‘Šé‡é»')">äº¤ç­å ±å‘Š</span>
                    </div>
                    <textarea id="c9" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>

                <div class="competency-item">
                    <div class="competency-title">10. æŒçºŒå­¸ç¿’èˆ‡ç™¼å±•</div>
                    <div class="tag-container">
                        <span class="tag reflection-tag" onclick="addText('c10', 'åƒèˆ‡éˆæ€§é—œæ‡·èª²ç¨‹')">åƒèˆ‡èª²ç¨‹</span>
                        <span class="tag reflection-tag" onclick="addText('c10', 'é–±è®€ç›¸é—œæ–‡ç»')">é–±è®€æ–‡ç»</span>
                        <span class="tag reflection-tag" onclick="addText('c10', 'å°‹æ±‚ç£å°å”åŠ©')">å°‹æ±‚ç£å°</span>
                    </div>
                    <textarea id="c10" rows="2" placeholder="åæ€ç´€éŒ„..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar" id="action-bar-record">
        <button class="btn btn-preview" onclick="showPreview()">ğŸ‘€ é è¦½ç´€éŒ„</button>
        <button class="btn btn-copy" onclick="copyResult('record')">ğŸ“‹ è¤‡è£½ç´€éŒ„</button>
    </div>

    <div class="action-bar" id="action-bar-reflection" style="display: none;">
        <button class="btn btn-copy-reflection" onclick="copyResult('reflection')">ğŸ“‹ è¤‡è£½åæ€</button>
    </div>

    <!-- Modal -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span>é è¦½çµæœ</span>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="previewContent"></div>
            <div class="modal-footer">
                <button class="btn btn-copy" onclick="copyResult('record')">ç¢ºèªä¸¦è¤‡è£½</button>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active', 'active-reflection');
            });
            
            const activeTab = document.querySelector(`.nav-tab[onclick="switchTab('${tabName}')"]`);
            if(tabName === 'reflection') {
                activeTab.classList.add('active-reflection');
            } else {
                activeTab.classList.add('active');
            }

            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`section-${tabName}`).classList.add('active');

            // Update action bar
            if(tabName === 'record') {
                document.getElementById('action-bar-record').style.display = 'flex';
                document.getElementById('action-bar-reflection').style.display = 'none';
            } else {
                document.getElementById('action-bar-record').style.display = 'none';
                document.getElementById('action-bar-reflection').style.display = 'flex';
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        function addText(elementId, text) {
            const el = document.getElementById(elementId);
            if (el.value) {
                // Determine separator based on context
                const isReflection = elementId.startsWith('c') && !isNaN(elementId.substring(1));
                const isSpiritDim = elementId === 'spirit_dim';
                const separator = (isReflection || isSpiritDim) ? 'ã€' : '\n';
                
                if (!el.value.includes(text)) {
                    el.value += separator + text;
                }
            } else {
                el.value = text;
            }
        }

        function setVitals(value) {
            document.getElementById('bp').value = value;
            document.getElementById('hr').value = value;
            document.getElementById('spo2').value = value;
        }

        function generateRecordContent() {
            let date = '';
            const dateInput = document.getElementById('recordDate').value;
            if (dateInput) {
                // Convert YYYY-MM-DD to YYYY/MM/DD
                date = dateInput.replace(/-/g, '/');
            } else {
                date = new Date().toLocaleDateString('zh-TW');
            }
            
            const s = document.getElementById('s_mood').value;
            const bp = document.getElementById('bp').value || '--';
            const hr = document.getElementById('hr').value || '--';
            const spo2 = document.getElementById('spo2').value || '--';
            const o = document.getElementById('o_activity').value;
            const a = document.getElementById('a_assessment').value;
            const c_status = document.getElementById('c_status').value;
            const c_goal = document.getElementById('c_goal').value || '--';
            const c_target = document.getElementById('c_target').value || '--';
            const c_content = document.getElementById('c_content').value || '--';
            const c_suggestion = document.getElementById('c_suggestion').value || '--';
            const spirit_dim = document.getElementById('spirit_dim').value;
            const spirit_stage = document.getElementById('spirit_stage').value;
            const spirit_note = document.getElementById('spirit_note').value;
            const p = document.getElementById('p_plan').value;

            let spirit_section = '';
            if (spirit_dim || spirit_stage || spirit_note) {
                spirit_section = `\nã€ğŸ•Šï¸ éˆæ€§é—œæ‡·ã€‘ï¼š\n- é¢å‘ï¼š${spirit_dim || 'æœªæ¨™è¨˜'}\n- éšæ®µï¼š${spirit_stage || 'æœªæ¨™è¨˜'}\n- ç´€éŒ„ï¼š${spirit_note || 'ç„¡'}\n`;
            }

            return `ã€æ—¥æœŸã€‘ï¼š${date}
ã€Sã€‘ï¼š
${s}

ã€Oã€‘ï¼š
- BP: ${bp}, HR: ${hr}, SpO2: ${spo2}%
- è¨“ç·´ï¼š
${o}

ã€Aã€‘ï¼š
${a}

ã€Cç¢¼ç”³å ±ã€‘ï¼š
- é”æˆæƒ…å½¢ï¼š${c_status}
- ç›®æ¨™ï¼š${c_goal}
- å°è±¡ï¼š${c_target}
- å…§å®¹ï¼š${c_content}
- å»ºè­°ï¼š${c_suggestion}${spirit_section}

ã€Pã€‘ï¼š
${p}`;
        }

        function generateReflectionContent() {
            const date = new Date().toLocaleDateString('zh-TW');
            let content = `ã€éˆæ€§é—œæ‡·è‡ªæˆ‘åæ€ EAPC-10ã€‘\næ—¥æœŸï¼š${date}\n\n`;
            let hasContent = false;
            
            for(let i=1; i<=10; i++) {
                const val = document.getElementById('c'+i).value;
                if(val) {
                    hasContent = true;
                    const titles = [
                        "è¾¨è­˜éˆæ€§éœ€æ±‚", "è©•ä¼°éˆæ€§èˆ‡å®—æ•™", "å°Šé‡æ–‡åŒ–èˆ‡åƒ¹å€¼", "å±•ç¾åŒç†å¿ƒ", "é‹ç”¨æºé€šæŠ€å·§",
                        "è‡ªæˆ‘è¦ºå¯Ÿèˆ‡åæ€", "åœ˜éšŠåˆä½œèˆ‡è½‰ä»‹", "å€«ç†èˆ‡æ³•å¾‹è€ƒé‡", "è¨˜éŒ„èˆ‡å ±å‘Š", "æŒçºŒå­¸ç¿’èˆ‡ç™¼å±•"
                    ];
                    content += `${i}. ${titles[i-1]}ï¼š${val}\n`;
                }
            }

            if(!hasContent) return null;
            return content;
        }

        function showPreview() {
            const content = generateRecordContent();
            document.getElementById('previewContent').innerText = content;
            document.getElementById('previewModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('previewModal').style.display = 'none';
        }

        function copyResult(type) {
            let content;
            if (type === 'record') {
                content = generateRecordContent();
            } else {
                content = generateReflectionContent();
                if (!content) {
                    alert("è«‹è‡³å°‘å¡«å¯«ä¸€é …åæ€ç´€éŒ„ï¼");
                    return;
                }
            }

            navigator.clipboard.writeText(content).then(() => {
                alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                if(type === 'record') closeModal();
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½é è¦½æ–‡å­—ã€‚');
            });
        }

        window.onclick = function(event) {
            const modal = document.getElementById('previewModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Initialize date picker to today
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('recordDate').value = `${yyyy}-${mm}-${dd}`;
        });
    </script>
</body>
</html>
